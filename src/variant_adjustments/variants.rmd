# COVID-19 Variant Adjustments

## Baseline Age Dependant Hospitalisation Rates

```{r include=FALSE}
base_ifr <- 
  structure(list(age_group = c("0-5", "5-10", "10-15", "15-20", 
"20-25", "25-30", "30-35", "35-40", "40-45", "45-50", "50-55", 
"55-60", "60-65", "65-70", "70-75", "75-80", "80+"), prob_hosp = c(0.000840764, 
0.001182411, 0.001662887, 0.002338607, 0.003288907, 0.004625365, 
0.006504897, 0.009148183, 0.012865577, 0.018093546, 0.025445917, 
0.035785947, 0.050327683, 0.0707785, 0.099539573, 0.1399878, 
0.233470395), prob_severe = c(0.181354223, 0.181354223, 0.181354223, 
0.137454906, 0.121938236, 0.122775613, 0.136057441, 0.160922182, 
0.196987378, 0.242011054, 0.289368845, 0.326537862, 0.337229819, 
0.309082553, 0.243794865, 0.160480254, 0.057084366), prob_death = c(0.012553468, 
0.013979635, 0.015567823, 0.016454101, 0.017999605, 0.020063626, 
0.022686491, 0.026012496, 0.030268714, 0.035709645, 0.042416637, 
0.049842448, 0.056400332, 0.060249095, 0.122602446, 0.184472303, 
0.340529746), prob_death_severe = c(0.226668959, 0.252420241, 
0.281097009, 0.413005389, 0.518451493, 0.573413613, 0.576222065, 
0.54253573, 0.493557696, 0.447376527, 0.416666608, 0.411186639, 
0.443382594, 0.538718871, 0.570434076, 0.643352843, 0.992620047
), death_notreat = c(0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 
0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6), death_notreat_severe = c(0.95, 
0.95, 0.95, 0.95, 0.95, 0.95, 0.95, 0.95, 0.95, 0.95, 0.95, 0.95, 
0.95, 0.95, 0.95, 0.95, 0.95)), class = c("tbl_df", "tbl", "data.frame"
), row.names = c(NA, -17L))

print(
  base_ifr %>% 
    rename(
      `Age Group` = age_group,
      `Probability of Hospitalisation` = prob_hosp,
      `Probability of Developing Severe Symptoms` = prob_severe,
      `Probability of Death, non-severe` = prob_death,
      `Probability of Death, severe` = prob_death_severe,
      `Probability of deaths, non-severe, no treatment` = death_notreat,
      `Probability of deaths, severe, no treatment` = death_notreat_severe
    ) %>% 
    mutate(
      across(
        where(is.numeric),
        ~paste0(signif(.x*100, 3), "%")
      )
    )
)
```

Values for proportion of infections hospitalised or requiring critical care (identical to ICU or mechanical ventilation) taken from [Salje et al.](https://www.science.org/doi/10.1126/science.abc3517).
We assume that 80% of deaths occur in ICU, from which the severity adjusted probabilities are calculated from [Report 34](https://www.imperial.ac.uk/mrc-global-infectious-disease-analysis/covid-19/report-34-ifr/).
The probability of death without treatment is a working assumption.

## Variant adjustments

```{r include=FALSE}
map_dfr(variant_characteristics, ~format_variant_characteristics(.x), .id = "Variant")
```

Over the period where a new variant is determined to have become dominant, we 
allow parameters around hospitalisation, severity, and duration of treatment
to change. We also simulate immune escape by increasing the rate at which
naturally acquired immunity is lost.

### Wild Type Assumptions

Vaccine efficacies are chosen to be representative of all vaccine types with values chosen from the [SPI-M-O Report](https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/984521/S1227_SPI-M-O_Summary_of_further_modelling_of_easing_restrictions_Roadmap_Step_3__2_.pdf).

Durations of treatment stratified by severity and outcome are estimated from a range of studies and ICNARC report (16th October 2020).

We assume that the Alpha variant only has an effect on transmission, which will
be captured by the $R_t$ fitting process.

### Delta Assumptions

For Delta we assume an increase in hospitalisation by 45%, from [Twohig et al.](https://www.thelancet.com/journals/laninf/article/PIIS1473-3099(21)00475-8/fulltext).

Estimates of vaccine efficacy against infection are taken from [Seppala et. al](https://www.eurosurveillance.org/content/10.2807/1560-7917.ES.2021.26.35.2100793) and coincide with estimates from [REACT-1](https://doi.org/10.1016/S2213-2600(21)00542-7).
Estimates for efficacy against disease (more precisely protection against hospitalisation) where taken from a [PHE preprint](https://khub.net/documents/135939561/479607266/Effectiveness+of+COVID-19+vaccines+against+hospital+admission+with+the+Delta+%28B.1.617.2%29+variant.pdf/1c213463-3997-ed16-2a6f-14e5deb0b997?t=1623689315431).
Immune escape percentage is taken from [Dhar et al.](https://www.science.org/doi/10.1126/science.abj9932).
Duration for hospitalisation if they survive is taken from [Lewnard et al.](https://www.medrxiv.org/content/10.1101/2022.01.11.22269045v1).

### Omicron Assumptions

To calculate the change in probability of hospitalisation we the hazard ratio of hospitalisation from Omicron in comparison to Delta in unvaccinated individuals of 0.59 from [Report 50](https://www.imperial.ac.uk/mrc-global-infectious-disease-analysis/covid-19/report-50-severity-omicron/).
We do not use the reinfection corrected hazard ratio of 0.76.
Since the protection provided by previous infections against worse outcomes (beyond a reduction in the chance of infection) is not included in Nimue (at the moment) and in almost all countries the majority of people will have past infections, it is more suitable to use the uncorrected estimate.

We also incorporate a reduction in severity and death, taken from [Lewnard et al.](https://www.medrxiv.org/content/10.1101/2022.01.11.22269045v1).
We use the hazard ratio of 0.34 in the risk of ICU admission, adjusted for the previous reduction in hospitalisation rates.
We do not incorporate a change to the risk of death.
Our assumed reduction in hospital admission is consistent with observations in this paper.

Using the vaccine efficacies for symptomatic infection after 14 days post dose 2 from [Report 49](https://www.imperial.ac.uk/mrc-global-infectious-disease-analysis/covid-19/report-49-omicron/) we assume that first dose vaccinations provide no protection and second doses provide 10%, a value between the lack of efficacy estimated for Astra Zeneca and low protection from the mRNA vaccine.
To estimate protection against hospitalisation we use [Report 50](https://www.imperial.ac.uk/mrc-global-infectious-disease-analysis/covid-19/report-50-severity-omicron/), with the average Omicron hazard ratio for the two vaccine types as a reduction to risk of Delta infection in the previous sections.
The resulting effectiveness is consistent with the levels reported in the [UHSA COVID-19 Vaccine Surveillance Report Week 4](https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/1050721/Vaccine-surveillance-report-week-4.pdf).
For simplicity we assume that the change in efficacy for first doses is the same as calculated in second doses.

Immune escape (naturally acquired immunity) percentage is calculated from [Report 49](https://www.imperial.ac.uk/mrc-global-infectious-disease-analysis/covid-19/report-49-omicron/).
Assuming that this effect only occurs whilst the new variant is becoming dominant (assumed to be 60 days) then the calculating the risk of becoming susceptible (from an assumed recovery period of a year), scaling by the increase in risk of reinfection.
With the current model setup the increase in risk of reinfection is difficult to translate directly as risk of reinfection would the risk of moving from R to S multiplied by the risk of infection, which is dependant on model dynamics.
New durations for hospitalisations taken from [Lewnard et al.](https://www.medrxiv.org/content/10.1101/2022.01.11.22269045v1).
Durations for ICU stay are taken from the INARC report Jan 2022.
These values are consistent with observations from South Africa.

## IFR Comparisons

```{r include=FALSE}
map_dfr(variant_characteristics, function(characteristics){
  base_ifr %>% 
    mutate(
      #update pars
      prob_hosp = prob_hosp * characteristics$prob_hosp_multiplier,
      prob_severe = prob_severe * characteristics$prob_severe_multiplier
    ) %>% 
    transmute(
      age_1 = seq_along(age_group)*5,
      age_2 = (seq_along(age_group) - 1)*5,
      `Treatment` = prob_hosp * (prob_severe * prob_death_severe +
                                                      (1 - prob_severe) * prob_death),
      `No Treatment` = prob_hosp * (prob_severe * death_notreat_severe +
                                                      (1 - prob_severe) * death_notreat),
      `First Vaccine Dose` = prob_hosp * (1 - characteristics$ve_disease[1]) * (prob_severe * prob_death_severe +
                                                      (1 - prob_severe) * prob_death),
      `Second Vaccine Dose` = prob_hosp * (1 - characteristics$ve_disease[2]) * (prob_severe * prob_death_severe +
                                                      (1 - prob_severe) * prob_death)
      ) %>% 
    pivot_longer(
      cols = !c(age_1, age_2),
      names_to = "Treatment:",
      values_to = "Infection Fatality Rate"
    )
}, .id = "Variant") %>% 
  mutate(Variant = factor(Variant, levels = c("Wild", "Delta", "Omicron"), ordered = TRUE),
         `Treatment:` = factor(`Treatment:`, levels = c("No Treatment", "Treatment", "First Vaccine Dose", "Second Vaccine Dose"), ordered = TRUE)) %>% 
  ggplot(aes(x = age_1, xend = age_2, y = `Infection Fatality Rate`,
             yend = `Infection Fatality Rate`, colour = `Treatment:`)) + 
  geom_segment(size = 1, alpha = 0.75) + 
  facet_wrap(vars(`Variant`)) + 
  ggpubr::theme_pubclean() + 
  labs(x = "Age Group") + 
  scale_y_continuous(labels = scales::percent)
```

Please note that the IFR for vaccine doses assumes that treatment is given.

## Variant Timings


